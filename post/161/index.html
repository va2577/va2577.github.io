<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JUPYTER NOTEBOOK で処理時間を測りました - Espresso &amp; Onigiri</title>
  <link rel="shortcut icon" href="/img/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
  <link rel="stylesheet" href="/css/main.css">
</head>
<body><header>
  <ul>
    <li>
      <a href="/">
        <img src="/img/identicon.png" alt="icon">
        <span class="title">Espresso &amp; Onigiri</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/post/">
        <svg class="octicon octicon-note" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M3 10h4V9H3v1zm0-2h6V7H3v1zm0-2h8V5H3v1zm10 6H1V3h12v9zM1 2c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1H1z"></path></svg>
        <span>BLOG</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/tags/">
        <svg class="octicon octicon-tag" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 000-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42 0 .83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z"></path></svg>
        <span>TAGS</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/categories/">
        <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
        <span>CATEGORIES</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/about/">
        <svg class="octicon octicon-person" viewBox="0 0 12 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M12 14.002a.998.998 0 01-.998.998H1.001A1 1 0 010 13.999V13c0-2.633 4-4 4-4s.229-.409 0-1c-.841-.62-.944-1.59-1-4 .173-2.413 1.867-3 3-3s2.827.586 3 3c-.056 2.41-.159 3.38-1 4-.229.59 0 1 0 1s4 1.367 4 4v1.002z"></path></svg>
        <span>ABOUT</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/privacy/">
        <svg class="octicon octicon-shield" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M0 2l7-2 7 2v6.02C14 12.69 8.69 16 7 16c-1.69 0-7-3.31-7-7.98V2zm1 .75L7 1l6 1.75v5.268C13 12.104 8.449 15 7 15c-1.449 0-6-2.896-6-6.982V2.75zm1 .75L7 2v12c-1.207 0-5-2.482-5-5.985V3.5z"></path></svg>
        <span>PRIVACY</span>
      </a>
    </li>
  </ul>
</header>
<div class="absolute">
  <nav>
    <a href="/">
      <svg class="octicon octicon-home" viewBox="0 0 16 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M16 9l-3-3V2h-2v2L8 1 0 9h2l1 5c0 .55.45 1 1 1h8c.55 0 1-.45 1-1l1-5h2zm-4 5H9v-4H7v4H4L2.81 7.69 8 2.5l5.19 5.19L12 14z"></path></svg>
      
    </a>
    <a href="/post/">
      <svg class="octicon octicon-note" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M3 10h4V9H3v1zm0-2h6V7H3v1zm0-2h8V5H3v1zm10 6H1V3h12v9zM1 2c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1H1z"></path></svg>
      
    </a>
    <a href="/tags/">
      <svg class="octicon octicon-tag" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 000-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42 0 .83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z"></path></svg>
      
    </a>
    <a href="/categories/">
      <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
      
    </a>
    <a href="/about/">
      <svg class="octicon octicon-person" viewBox="0 0 12 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M12 14.002a.998.998 0 01-.998.998H1.001A1 1 0 010 13.999V13c0-2.633 4-4 4-4s.229-.409 0-1c-.841-.62-.944-1.59-1-4 .173-2.413 1.867-3 3-3s2.827.586 3 3c-.056 2.41-.159 3.38-1 4-.229.59 0 1 0 1s4 1.367 4 4v1.002z"></path></svg>
      
    </a>
    <a href="/privacy/">
      <svg class="octicon octicon-shield" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M0 2l7-2 7 2v6.02C14 12.69 8.69 16 7 16c-1.69 0-7-3.31-7-7.98V2zm1 .75L7 1l6 1.75v5.268C13 12.104 8.449 15 7 15c-1.449 0-6-2.896-6-6.982V2.75zm1 .75L7 2v12c-1.207 0-5-2.482-5-5.985V3.5z"></path></svg>
      
    </a>
  </nav>
</div>
<style>
  header {
    align-items: center;
    border-bottom: #e2e8f0 solid 1px;
    display: flex;
    height: 92px;
    margin: 0px auto;
    width: 992px;
  }
  header ul {
    align-items: center;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
    list-style-type: none;
    margin: 0px;
    padding: 0px;
    width: 100%;
  }
  header li:first-child a {
    align-items: center;
    display: flex;
  }
  header li:first-child span {
    align-items: center;
    color: #2f495e;
    font-size: 24px;
    margin-left: 6px;
  }
  header a {
    color: #2f495e;
  }
  header img {
    display: inline-block;
    height: 40px;
    width: 40px;
  }
  .absolute {
    display: none;
    position: absolute;
  }
  .absolute nav {
    background-color: #fff;
    border-top: #e2e8f0 solid 1px;
    bottom: 0;
    display: flex;
    height: 60px;
    justify-content: space-between;
    left: 0;
    position: fixed;
    right: 0;
    z-index: 30;
  }
  .absolute nav a {
    color: #2f495e;
    padding-bottom: 0;
    padding-left: .5rem;
    padding-right: .5rem;
    padding-top: .75rem;
    text-align: center;
  }
  .octicon {
    display: inline-block;
    fill: #2f495e;
    height: 32px;
    line-height: 56px;
    vertical-align: middle;
    width: 32px;
  }
  @media screen and (max-width: 992px) {
    header {
      padding-left: 1%;
      padding-right: 1%;
      width: 98%;
    }
    header .nav-li {
      display: none;
    }
    .absolute {
      display: block;
    }
  }
</style>
<div id="content">
  <main>
    <h1>Jupyter Notebook で処理時間を測りました</h1>
    
      <div><time>May 11, 2018</time></div>
    
    
    <article>
      
        <aside class="ads">
  <div>広告</div>
  <div>
    <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9305907051774965" data-ad-slot="2028899530" data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</aside>
<style>
  aside.ads {
    margin-bottom: 2.5rem;
    margin-top: 2.5rem;
  }
</style>

      
      <p>前回、<a href="/post/160/">リスト内包表記のパフォーマンスを計測した</a>ときに、 Jupyter Notebook のマジックコマンドを調べましたので書いておきます。</p>
<h2 id="環境">環境</h2>
<ul>
<li>Python 3.5.2</li>
<li>jupyter-1.0.0</li>
</ul>
<h2 id="time">%time</h2>
<blockquote>
<p>%time</p>
<p>Time execution of a Python statement or expression.</p>
<p>The CPU and wall clock times are printed, and the value of the expression (if any) is returned. Note that under Win32, system time is always reported as 0, since it can not be measured.</p>
<p>This function can be used both as a line and cell magic:</p>
<ul>
<li>
<p>In line mode you can time a single-line statement (though multiple ones can be chained with using semicolons).</p>
</li>
<li>
<p>In cell mode, you can time the cell body (a directly following statement raises an error).</p>
<p>This function provides very basic timing functionality. Use the timeit magic for more control over the measurement.</p>
</li>
</ul>
<p><cite><a href="http://ipython.readthedocs.io/en/stable/interactive/magics.html?highlight=%25time#magic-time">%time</a></cite></p>
</blockquote>
<p>line mode と cell mode があるようです。
1 行の時間を計測する場合は line mode の <code>%time</code> を使うようです。
セルの時間を計測する場合は cell mode の <code>%%time</code> を使うようです。
cell mode はパーセント記号が二つのようです。</p>
<h3 id="line-mode">line mode</h3>
<p>次のような記述をして、</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">%</span>time i <span style="color:#f92672">=</span> sum([<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1000000</span>)])
i
</code></pre></div><p>実行すると、</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># CPU times: user 109 ms, sys: 0 ns, total: 109 ms</span>
<span style="color:#75715e"># Wall time: 114 ms</span>
<span style="color:#75715e"># 1000000</span>
</code></pre></div><blockquote>
<p>Elapsed real time, real time, wall-clock time, or wall time is the actual time taken from the start of a computer program to the end. In other words, it is the difference between the time at which a task finishes and the time at which the task started.</p>
<p><cite><a href="https://en.wikipedia.org/wiki/Elapsed_real_time">Elapsed real time</a></cite></p>
</blockquote>
<p>Wall time は「実世界」の時間のようです。
この場合は 114 ms のようです。</p>
<h3 id="cell-mode">cell mode</h3>
<p>次のような記述をして、</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">%</span><span style="color:#f92672">%</span>time
i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1000000</span>):
    i <span style="color:#f92672">+</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
i
</code></pre></div><p>実行すると、</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># CPU times: user 188 ms, sys: 0 ns, total: 188 ms</span>
<span style="color:#75715e"># Wall time: 190 ms</span>
</code></pre></div><p>cell mode は最後に記述した変数を Out のセルに出力してくれないようでした。</p>
<h2 id="timeit">%timeit</h2>
<blockquote>
<p>%timeit</p>
<p>Time execution of a Python statement or expression</p>
<blockquote>
<p>Usage, in line mode:</p>
</blockquote>
<p>%timeit [-n&lt;N&gt; -r&lt;R&gt; [-t|-c] -q -p&lt;P&gt; -o] statement</p>
<blockquote>
<p>or in cell mode:</p>
</blockquote>
<p>%%timeit [-n&lt;N&gt; -r&lt;R&gt; [-t|-c] -q -p&lt;P&gt; -o] setup_code code code…</p>
<p>Time execution of a Python statement or expression using the timeit module. This function can be used both as a line and cell magic:</p>
<ul>
<li>In line mode you can time a single-line statement (though multiple ones can be chained with using semicolons).</li>
<li>In cell mode, the statement in the first line is used as setup code (executed but not timed) and the body of the cell is timed. The cell body has access to any variables created in the setup code.</li>
</ul>
<p>Options: -n&lt;N&gt;: execute the given statement &lt;N&gt; times in a loop. If this value is not given, a fitting value is chosen.</p>
<p>-r&lt;R&gt;: repeat the loop iteration &lt;R&gt; times and take the best result. Default: 3</p>
<p>-t: use time.time to measure the time, which is the default on Unix. This function measures wall time.</p>
<p>-c: use time.clock to measure the time, which is the default on Windows and measures wall time. On Unix, resource.getrusage is used instead and returns the CPU user time.</p>
<p>-p&lt;P&gt;: use a precision of &lt;P&gt; digits to display the timing result. Default: 3</p>
<p>-q: Quiet, do not print result.</p>
<blockquote>
<p>-o: return a TimeitResult that can be stored in a variable to inspect</p>
</blockquote>
<p>the result in more details.</p>
<p><cite><a href="http://ipython.readthedocs.io/en/stable/interactive/magics.html?highlight=%25time#magic-timeit">%timeit</a></cite></p>
</blockquote>
<p>%timeit は与えられた処理を繰り返して処理時間を計測してくれるようです。
オプションで繰り返す数を指定できるようです。</p>
<p>%timeit も line mode と cell mode があって、 cell mode はパーセント記号が二つのようです。</p>
<h3 id="line-mode-1">line mode</h3>
<p>次のような記述をして、</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">%</span>timeit i <span style="color:#f92672">=</span> sum([<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1000000</span>)])
i
</code></pre></div><p>実行すると、</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 74.8 ms ± 692 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
<span style="color:#75715e"># NameError: name &#39;i&#39; is not defined</span>
</code></pre></div><p><code>%timeit</code> は変数を中に閉じ込めるようで、 Out のセルに出力することはできないようでした。</p>
<h3 id="cell-mode-1">cell mode</h3>
<p>次のような記述をして、</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">%</span><span style="color:#f92672">%</span>timeit
i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1000000</span>):
    i <span style="color:#f92672">+</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
i
</code></pre></div><p>実行すると、</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 98.8 ms ± 2.32 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</code></pre></div><p>cell mode も変数を中に閉じ込めるようで、 Out のセルに出力することはできないようでした。</p>
<h2 id="終わり">終わり</h2>
<p>他にもマジックコマンドがあったので、うまく使っていきたいです。</p>
<h2 id="参考">参考</h2>
<ul>
<li><a href="http://ipython.readthedocs.io/en/stable/interactive/magics.html">Built-in magic commands — IPython 6.4.0 documentation</a></li>
</ul>
      
        <aside class="ads">
  <div>広告</div>
  <div>
    <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9305907051774965" data-ad-slot="2028899530" data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</aside>
<style>
  aside.ads {
    margin-bottom: 2.5rem;
    margin-top: 2.5rem;
  }
</style>

      
    </article>
  </main>

        </div><footer>
  <small>&copy; 2015 Espresso &amp; Onigiri</small>
  <a href="https://gohugo.io">
    <img alt="Hugo" src="/img/hugo-logo-wide.svg">
  </a>
</footer>
<style>
  footer {
    align-items: center;
    border-top: #e2e8f0 solid 1px;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    height: 73px;
    justify-content: space-between;
    margin: 0px auto;
    width: 992px;
  }
  footer small {
    height: 40px;
    line-height: 40px;
  }
  footer img {
    height: 40px;
    vertical-align: middle;
    width: 160px;
  }
  @media screen and (max-width: 992px) {
    footer {
      margin-bottom: 64px;
      padding-left: 1%;
      padding-right: 1%;
      width: 98%;
    }
    footer img {
      width: 100px;
    }
  }
</style>
</body>
</html>
