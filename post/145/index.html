<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CHART.JS を使ってみました - Espresso &amp; Onigiri</title>
  <link rel="shortcut icon" href="/img/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
  <link rel="stylesheet" href="/css/main.css">
</head>
<body><header>
  <ul>
    <li>
      <a href="/">
        <img src="/img/identicon.png" alt="icon">
        <span class="title">Espresso &amp; Onigiri</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/post/">
        <svg class="octicon octicon-note" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M3 10h4V9H3v1zm0-2h6V7H3v1zm0-2h8V5H3v1zm10 6H1V3h12v9zM1 2c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1H1z"></path></svg>
        <span>BLOG</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/tags/">
        <svg class="octicon octicon-tag" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 000-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42 0 .83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z"></path></svg>
        <span>TAGS</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/categories/">
        <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
        <span>CATEGORIES</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/about/">
        <svg class="octicon octicon-person" viewBox="0 0 12 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M12 14.002a.998.998 0 01-.998.998H1.001A1 1 0 010 13.999V13c0-2.633 4-4 4-4s.229-.409 0-1c-.841-.62-.944-1.59-1-4 .173-2.413 1.867-3 3-3s2.827.586 3 3c-.056 2.41-.159 3.38-1 4-.229.59 0 1 0 1s4 1.367 4 4v1.002z"></path></svg>
        <span>ABOUT</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/privacy/">
        <svg class="octicon octicon-shield" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M0 2l7-2 7 2v6.02C14 12.69 8.69 16 7 16c-1.69 0-7-3.31-7-7.98V2zm1 .75L7 1l6 1.75v5.268C13 12.104 8.449 15 7 15c-1.449 0-6-2.896-6-6.982V2.75zm1 .75L7 2v12c-1.207 0-5-2.482-5-5.985V3.5z"></path></svg>
        <span>PRIVACY</span>
      </a>
    </li>
  </ul>
</header>
<div class="absolute">
  <nav>
    <a href="/">
      <svg class="octicon octicon-home" viewBox="0 0 16 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M16 9l-3-3V2h-2v2L8 1 0 9h2l1 5c0 .55.45 1 1 1h8c.55 0 1-.45 1-1l1-5h2zm-4 5H9v-4H7v4H4L2.81 7.69 8 2.5l5.19 5.19L12 14z"></path></svg>
      
    </a>
    <a href="/post/">
      <svg class="octicon octicon-note" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M3 10h4V9H3v1zm0-2h6V7H3v1zm0-2h8V5H3v1zm10 6H1V3h12v9zM1 2c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1H1z"></path></svg>
      
    </a>
    <a href="/tags/">
      <svg class="octicon octicon-tag" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 000-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42 0 .83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z"></path></svg>
      
    </a>
    <a href="/categories/">
      <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
      
    </a>
    <a href="/about/">
      <svg class="octicon octicon-person" viewBox="0 0 12 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M12 14.002a.998.998 0 01-.998.998H1.001A1 1 0 010 13.999V13c0-2.633 4-4 4-4s.229-.409 0-1c-.841-.62-.944-1.59-1-4 .173-2.413 1.867-3 3-3s2.827.586 3 3c-.056 2.41-.159 3.38-1 4-.229.59 0 1 0 1s4 1.367 4 4v1.002z"></path></svg>
      
    </a>
    <a href="/privacy/">
      <svg class="octicon octicon-shield" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M0 2l7-2 7 2v6.02C14 12.69 8.69 16 7 16c-1.69 0-7-3.31-7-7.98V2zm1 .75L7 1l6 1.75v5.268C13 12.104 8.449 15 7 15c-1.449 0-6-2.896-6-6.982V2.75zm1 .75L7 2v12c-1.207 0-5-2.482-5-5.985V3.5z"></path></svg>
      
    </a>
  </nav>
</div>
<style>
  header {
    align-items: center;
    border-bottom: #e2e8f0 solid 1px;
    display: flex;
    height: 92px;
    margin: 0px auto;
    width: 992px;
  }
  header ul {
    align-items: center;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
    list-style-type: none;
    margin: 0px;
    padding: 0px;
    width: 100%;
  }
  header li:first-child a {
    align-items: center;
    display: flex;
  }
  header li:first-child span {
    align-items: center;
    color: #2f495e;
    font-size: 24px;
    margin-left: 6px;
  }
  header a {
    color: #2f495e;
  }
  header img {
    display: inline-block;
    height: 40px;
    width: 40px;
  }
  .absolute {
    display: none;
    position: absolute;
  }
  .absolute nav {
    background-color: #fff;
    border-top: #e2e8f0 solid 1px;
    bottom: 0;
    display: flex;
    height: 60px;
    justify-content: space-between;
    left: 0;
    position: fixed;
    right: 0;
    z-index: 30;
  }
  .absolute nav a {
    color: #2f495e;
    padding-bottom: 0;
    padding-left: .5rem;
    padding-right: .5rem;
    padding-top: .75rem;
    text-align: center;
  }
  .octicon {
    display: inline-block;
    fill: #2f495e;
    height: 32px;
    line-height: 56px;
    vertical-align: middle;
    width: 32px;
  }
  @media screen and (max-width: 992px) {
    header {
      padding-left: 1%;
      padding-right: 1%;
      width: 98%;
    }
    header .nav-li {
      display: none;
    }
    .absolute {
      display: block;
    }
  }
</style>
<div id="content">
  <main>
    <h1>Chart.js を使ってみました</h1>
    
      <div><time>April 25, 2018</time></div>
    
    
    <article>
      
        <aside class="ads">
  <div>広告</div>
  <div>
    <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9305907051774965" data-ad-slot="2028899530" data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</aside>
<style>
  aside.ads {
    margin-bottom: 2.5rem;
    margin-top: 2.5rem;
  }
</style>

      
      <p>為替レートのチャートをウェブサイトに表示したかったので、 <a href="http://www.chartjs.org/">Chart.js</a> を使ってみました。</p>
<script src="//cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
<p>今回は、ローソク足のような細かいチャートではなくて、高値と安値が確認できる程度のラインチャートが表示できればよかったので、他にもっと高機能なチャートを表示するライブラリーはあると思うのですが、 Chart.js を使ってみることにしました。</p>
<h2 id="環境">環境</h2>
<ul>
<li>Chart.js Version 2.7.2</li>
</ul>
<h2 id="chartjs">Chart.js?</h2>
<p>Chart.js は、次のような特徴があるようです。</p>
<ul>
<li>Open source</li>
<li>8 Chart types</li>
<li>HTML5 Canvas</li>
<li>Responsive</li>
</ul>
<h2 id="installation">Installation</h2>
<p><a href="http://www.chartjs.org/docs/latest/getting-started/installation.html#npm">npm</a> や <a href="http://www.chartjs.org/docs/latest/getting-started/installation.html#bower">Bower</a> や <a href="http://www.chartjs.org/docs/latest/getting-started/installation.html#cdn">CDN</a> からインストールして使うことができるようです。
今回は、 CDN から使うことにしました。</p>
<h3 id="stand-alone-build-と-bundled-build">Stand-Alone Build と Bundled Build</h3>
<p>Chart.js には、 Stand-Alone Build と Bundled Build の二つがあるようです。</p>
<blockquote>
<p>Files:</p>
<ul>
<li><code>dist/Chart.js</code></li>
<li><code>dist/Chart.min.js</code></li>
</ul>
<p>The stand-alone build includes Chart.js as well as the color parsing library. If this version is used, you are required to include Moment.js before Chart.js for the functionality of the time axis.</p>
<p><cite><a href="http://www.chartjs.org/docs/latest/getting-started/installation.html#stand-alone-build">Stand-Alone Build</a></cite></p>
</blockquote>
<p>Stand-Alone Build には Moment.js が含まれていないようです。</p>
<blockquote>
<p>Files:</p>
<ul>
<li><code>dist/Chart.bundle.js</code></li>
<li><code>dist/Chart.bundle.min.js</code></li>
</ul>
<p>The bundled build includes Moment.js in a single file. You should use this version if you require time axes and want to include a single file. You should not use this build if your application already included Moment.js. Otherwise, Moment.js will be included twice which results in increasing page load time and possible version compatability issues.</p>
<p><cite><a href="http://www.chartjs.org/docs/latest/getting-started/installation.html#bundled-build">Bundled Build</a></cite></p>
</blockquote>
<p>Bundled Build には Moment.js が含まれているようです。</p>
<p>Moment.js は、 time axes の機能を使うのに必要みたいです。
time axes は時間の軸のようで、 軸のデータを Date 型で扱えるようです。</p>
<p>アプリ側で Moment.js を使う必要がある場合は、 Moment.js を読み込んで、その後、 Stand-Alone Build を読み込む必要があるようです。
アプリ側で Moment.js を使う必要がない場合は、 Bundled Build だけを読み込めばよいみたいです。
アプリ側で Moment.js を読み込みつつ、 Bundled Build も読み込んでしまうと、それぞれの Moment.js が競合してしまってあまりよくないみたいです。</p>
<p>今回は、アプリ側で Moment.js を使う必要がないので、 Bundled Build を使うことにしました。</p>
<h2 id="getting-started">Getting Started</h2>
<p><a href="http://www.chartjs.org/docs/latest/getting-started/">Getting Started</a> のサンプルのチャートを表示してみます。</p>
<p><canvas id="myChart" width="400" height="400"></canvas></p>
<script>
  var ctx = document.getElementById("myChart").getContext('2d');
  var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
      datasets: [{
        label: '# of Votes',
        data: [12, 19, 3, 5, 2, 3],
        backgroundColor: [
          'rgba(255, 99, 132, 0.2)',
          'rgba(54, 162, 235, 0.2)',
          'rgba(255, 206, 86, 0.2)',
          'rgba(75, 192, 192, 0.2)',
          'rgba(153, 102, 255, 0.2)',
          'rgba(255, 159, 64, 0.2)'
        ],
        borderColor: [
          'rgba(255, 99, 132, 1)',
          'rgba(54, 162, 235, 1)',
          'rgba(255, 206, 86, 1)',
          'rgba(75, 192, 192, 1)',
          'rgba(153, 102, 255, 1)',
          'rgba(255, 159, 64, 1)'
        ],
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        yAxes: [{
          ticks: {
            beginAtZero: true
          }
        }]
      }
    }
  });
</script>
<p>たぶん、棒グラフが表示されていると思います。</p>
<p><code>&lt;canvas height=&quot;400&quot; width=&quot;400&quot; …</code> のようにサイズを指定しているのですが、大きいような気もしますけれども。</p>
<blockquote>
<p>When it comes to change the chart size based on the window size, a major limitation is that the canvas render size (canvas.width and .height) can not be expressed with relative values, contrary to the display size (canvas.style.width and .height). Furthermore, these sizes are independent from each other and thus the canvas render size does not adjust automatically based on the display size, making the rendering inaccurate.</p>
<p><cite><a href="http://www.chartjs.org/docs/latest/general/responsive.html">Responsive · Chart.js documentation</a></cite></p>
</blockquote>
<p>Chart.js はレスポンシブ対応で、ウィンドウサイズに合わせていい感じに表示してくれるみたいです。
それが影響しているのかな。</p>
<h2 id="折れ線グラフ">折れ線グラフ</h2>
<p>為替レートを折れ線グラフで表示してみます。</p>
<p><a href="http://www.chartjs.org/docs/latest/charts/line.html">Line</a> のページと <a href="http://www.chartjs.org/docs/latest/charts/line.html">Line</a> のページのソースを参考に、次のように記述しました。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;320&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;640&#34;</span>&gt;
  &lt;<span style="color:#f92672">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;canvas2&#34;</span>&gt;&lt;/<span style="color:#f92672">canvas</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;

&lt;<span style="color:#f92672">script</span>&gt;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;canvas2&#39;</span>).<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#39;2d&#39;</span>);
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">datasets</span><span style="color:#f92672">:</span> [{
      <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">106.237</span>, <span style="color:#ae81ff">105.877</span>, <span style="color:#ae81ff">106.598</span>, <span style="color:#ae81ff">106.774</span>, <span style="color:#ae81ff">107.374</span>, <span style="color:#ae81ff">106.937</span>, <span style="color:#ae81ff">106.754</span>, <span style="color:#ae81ff">107.19</span>, <span style="color:#ae81ff">106.777</span>, <span style="color:#ae81ff">107.294</span>, <span style="color:#ae81ff">107.468</span>, <span style="color:#ae81ff">107.104</span>, <span style="color:#ae81ff">106.991</span>, <span style="color:#ae81ff">107.223</span>, <span style="color:#ae81ff">107.354</span>, <span style="color:#ae81ff">107.768</span>, <span style="color:#ae81ff">108.698</span>, <span style="color:#ae81ff">108.808</span>, <span style="color:#ae81ff">109.418</span>, <span style="color:#ae81ff">109.288</span>, <span style="color:#ae81ff">109.063</span>],
      <span style="color:#a6e22e">fill</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
      <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;米ドル/円&#39;</span>
    }],
    <span style="color:#a6e22e">labels</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;2018/04/02&#39;</span>, <span style="color:#e6db74">&#39;2018/04/03&#39;</span>, <span style="color:#e6db74">&#39;2018/04/04&#39;</span>, <span style="color:#e6db74">&#39;2018/04/05&#39;</span>, <span style="color:#e6db74">&#39;2018/04/06&#39;</span>, <span style="color:#e6db74">&#39;2018/04/09&#39;</span>, <span style="color:#e6db74">&#39;2018/04/10&#39;</span>, <span style="color:#e6db74">&#39;2018/04/11&#39;</span>, <span style="color:#e6db74">&#39;2018/04/12&#39;</span>, <span style="color:#e6db74">&#39;2018/04/13&#39;</span>, <span style="color:#e6db74">&#39;2018/04/16&#39;</span>, <span style="color:#e6db74">&#39;2018/04/17&#39;</span>, <span style="color:#e6db74">&#39;2018/04/18&#39;</span>, <span style="color:#e6db74">&#39;2018/04/19&#39;</span>, <span style="color:#e6db74">&#39;2018/04/20&#39;</span>, <span style="color:#e6db74">&#39;2018/04/23&#39;</span>, <span style="color:#e6db74">&#39;2018/04/24&#39;</span>, <span style="color:#e6db74">&#39;2018/04/25&#39;</span>, <span style="color:#e6db74">&#39;2018/04/26&#39;</span>, <span style="color:#e6db74">&#39;2018/04/27&#39;</span>, <span style="color:#e6db74">&#39;2018/04/30&#39;</span>]
  };
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">options</span> <span style="color:#f92672">=</span> {};
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Chart</span>(<span style="color:#a6e22e">ctx</span>, {
    <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">data</span>,
    <span style="color:#a6e22e">options</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">options</span>,
    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;line&#39;</span>
  });
&lt;/<span style="color:#f92672">script</span>&gt;
</code></pre></div><div height="320" width="640">
  <canvas id="canvas2"></canvas>
</div>
<script>
  (function () {
    var ctx = document.getElementById('canvas2').getContext('2d');
    var data = {
      datasets: [{
        data: [106.237, 105.877, 106.598, 106.774, 107.374, 106.937, 106.754, 107.19, 106.777, 107.294, 107.468, 107.104, 106.991, 107.223, 107.354, 107.768, 108.698, 108.808, 109.418, 109.288, 109.063],
        fill: false,
        label: '米ドル/円'
      }],
      labels: ['2018/04/02', '2018/04/03', '2018/04/04', '2018/04/05', '2018/04/06', '2018/04/09', '2018/04/10', '2018/04/11', '2018/04/12', '2018/04/13', '2018/04/16', '2018/04/17', '2018/04/18', '2018/04/19', '2018/04/20', '2018/04/23', '2018/04/24', '2018/04/25', '2018/04/26', '2018/04/27', '2018/04/30']
    };
    var options = {};
    var c = new Chart(ctx, {
      data: data,
      options: options,
      type: 'line'
    });
  })();
</script>
<p>凝ったオプションは指定せずに、ラベルとデータだけ指定してみました。
Chart.js の折れ線グラフのデフォルトだと、線の下側を塗りつぶしてしまうようなので、 <code>fill: false</code> だけつけました。</p>
<p>直線じゃなく、緩やかなカーブのある線になっています。
直線だと、ローソク足と切り離された印象も受けるので、緩やかな線の方がよいかもしれません。</p>
<p>オプションを指定することで直線にもできるみたいです。
<a href="http://www.chartjs.org/docs/latest/charts/line.html#disable-bezier-curves">Disable Bezier Curves</a> に記載されていました。
ベジェ曲線を無効にすればよいみたいです。
<code>options.elements.line.tension = 0</code> になるような指定をすると、ベジェ曲線を無効にすることができるようです。
こうすると、描画のパフォーマンスが向上するみたいです。</p>
<h2 id="終わり">終わり</h2>
<p>ラインチャートを画像で作成しようと思っていたのですが、 Chart.js で置き換えられそうです。
画像だと修正の手間がかかりますし、ファイルの容量も大きくなりますので、便利になりそうです。</p>
      
        <aside class="ads">
  <div>広告</div>
  <div>
    <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9305907051774965" data-ad-slot="2028899530" data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</aside>
<style>
  aside.ads {
    margin-bottom: 2.5rem;
    margin-top: 2.5rem;
  }
</style>

      
    </article>
  </main>

        </div><footer>
  <small>&copy; 2015 Espresso &amp; Onigiri</small>
  <a href="https://gohugo.io">
    <img alt="Hugo" src="/img/hugo-logo-wide.svg">
  </a>
</footer>
<style>
  footer {
    align-items: center;
    border-top: #e2e8f0 solid 1px;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    height: 73px;
    justify-content: space-between;
    margin: 0px auto;
    width: 992px;
  }
  footer small {
    height: 40px;
    line-height: 40px;
  }
  footer img {
    height: 40px;
    vertical-align: middle;
    width: 160px;
  }
  @media screen and (max-width: 992px) {
    footer {
      margin-bottom: 64px;
      padding-left: 1%;
      padding-right: 1%;
      width: 98%;
    }
    footer img {
      width: 100px;
    }
  }
</style>
</body>
</html>
