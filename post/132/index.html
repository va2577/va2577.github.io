<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HUGO のテーマを作ってみます 6(MENU TEMPLATES) - Espresso &amp; Onigiri</title>
  <link rel="shortcut icon" href="/img/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
  <link rel="stylesheet" href="/css/main.css">
</head>
<body><header>
  <ul>
    <li>
      <a href="/">
        <img src="/img/identicon.png" alt="icon">
        <span class="title">Espresso &amp; Onigiri</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/post/">
        <svg class="octicon octicon-note" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M3 10h4V9H3v1zm0-2h6V7H3v1zm0-2h8V5H3v1zm10 6H1V3h12v9zM1 2c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1H1z"></path></svg>
        <span>BLOG</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/tags/">
        <svg class="octicon octicon-tag" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 000-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42 0 .83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z"></path></svg>
        <span>TAGS</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/categories/">
        <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
        <span>CATEGORIES</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/about/">
        <svg class="octicon octicon-person" viewBox="0 0 12 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M12 14.002a.998.998 0 01-.998.998H1.001A1 1 0 010 13.999V13c0-2.633 4-4 4-4s.229-.409 0-1c-.841-.62-.944-1.59-1-4 .173-2.413 1.867-3 3-3s2.827.586 3 3c-.056 2.41-.159 3.38-1 4-.229.59 0 1 0 1s4 1.367 4 4v1.002z"></path></svg>
        <span>ABOUT</span>
      </a>
    </li>
    <li class="nav-li">
      <a href="/privacy/">
        <svg class="octicon octicon-shield" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M0 2l7-2 7 2v6.02C14 12.69 8.69 16 7 16c-1.69 0-7-3.31-7-7.98V2zm1 .75L7 1l6 1.75v5.268C13 12.104 8.449 15 7 15c-1.449 0-6-2.896-6-6.982V2.75zm1 .75L7 2v12c-1.207 0-5-2.482-5-5.985V3.5z"></path></svg>
        <span>PRIVACY</span>
      </a>
    </li>
  </ul>
</header>
<div class="absolute">
  <nav>
    <a href="/">
      <svg class="octicon octicon-home" viewBox="0 0 16 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M16 9l-3-3V2h-2v2L8 1 0 9h2l1 5c0 .55.45 1 1 1h8c.55 0 1-.45 1-1l1-5h2zm-4 5H9v-4H7v4H4L2.81 7.69 8 2.5l5.19 5.19L12 14z"></path></svg>
      
    </a>
    <a href="/post/">
      <svg class="octicon octicon-note" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M3 10h4V9H3v1zm0-2h6V7H3v1zm0-2h8V5H3v1zm10 6H1V3h12v9zM1 2c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1H1z"></path></svg>
      
    </a>
    <a href="/tags/">
      <svg class="octicon octicon-tag" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 000-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42 0 .83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z"></path></svg>
      
    </a>
    <a href="/categories/">
      <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
      
    </a>
    <a href="/about/">
      <svg class="octicon octicon-person" viewBox="0 0 12 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M12 14.002a.998.998 0 01-.998.998H1.001A1 1 0 010 13.999V13c0-2.633 4-4 4-4s.229-.409 0-1c-.841-.62-.944-1.59-1-4 .173-2.413 1.867-3 3-3s2.827.586 3 3c-.056 2.41-.159 3.38-1 4-.229.59 0 1 0 1s4 1.367 4 4v1.002z"></path></svg>
      
    </a>
    <a href="/privacy/">
      <svg class="octicon octicon-shield" viewBox="0 0 14 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M0 2l7-2 7 2v6.02C14 12.69 8.69 16 7 16c-1.69 0-7-3.31-7-7.98V2zm1 .75L7 1l6 1.75v5.268C13 12.104 8.449 15 7 15c-1.449 0-6-2.896-6-6.982V2.75zm1 .75L7 2v12c-1.207 0-5-2.482-5-5.985V3.5z"></path></svg>
      
    </a>
  </nav>
</div>
<style>
  header {
    align-items: center;
    border-bottom: #e2e8f0 solid 1px;
    display: flex;
    height: 92px;
    margin: 0px auto;
    width: 992px;
  }
  header ul {
    align-items: center;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
    list-style-type: none;
    margin: 0px;
    padding: 0px;
    width: 100%;
  }
  header li:first-child a {
    align-items: center;
    display: flex;
  }
  header li:first-child span {
    align-items: center;
    color: #2f495e;
    font-size: 24px;
    margin-left: 6px;
  }
  header a {
    color: #2f495e;
  }
  header img {
    display: inline-block;
    height: 40px;
    width: 40px;
  }
  .absolute {
    display: none;
    position: absolute;
  }
  .absolute nav {
    background-color: #fff;
    border-top: #e2e8f0 solid 1px;
    bottom: 0;
    display: flex;
    height: 60px;
    justify-content: space-between;
    left: 0;
    position: fixed;
    right: 0;
    z-index: 30;
  }
  .absolute nav a {
    color: #2f495e;
    padding-bottom: 0;
    padding-left: .5rem;
    padding-right: .5rem;
    padding-top: .75rem;
    text-align: center;
  }
  .octicon {
    display: inline-block;
    fill: #2f495e;
    height: 32px;
    line-height: 56px;
    vertical-align: middle;
    width: 32px;
  }
  @media screen and (max-width: 992px) {
    header {
      padding-left: 1%;
      padding-right: 1%;
      width: 98%;
    }
    header .nav-li {
      display: none;
    }
    .absolute {
      display: block;
    }
  }
</style>
<div id="content">
  <main>
    <h1>Hugo のテーマを作ってみます 6(Menu Templates)</h1>
    
      <div><time>April 12, 2018</time></div>
    
    
    <article>
      
        <aside class="ads">
  <div>広告</div>
  <div>
    <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9305907051774965" data-ad-slot="2028899530" data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</aside>
<style>
  aside.ads {
    margin-bottom: 2.5rem;
    margin-top: 2.5rem;
  }
</style>

      
      <p><a href="/post/131/">前回の記事</a>では、 <a href="https://gohugo.io/templates/404/">Custom 404 Page</a> を使ってみました。
今回は、 <a href="https://gohugo.io/templates/menu-templates/">Menu Templates</a> を使ってみます。</p>
<p>最初に、<a href="/post/115/">この記事</a>の通り、サイトとテーマの骨組みを作成しておきました。</p>
<h2 id="環境">環境</h2>
<ul>
<li>Hugo Static Site Generator v0.38.2</li>
</ul>
<h2 id="menu-templates">Menu Templates?</h2>
<blockquote>
<p>Menu Templates</p>
<p>Menus are a powerful but simple feature for content management but can be easily manipulated in your templates to meet your design needs.</p>
<p><cite><a href="https://gohugo.io/templates/menu-templates/">Menu Templates | Hugo</a></cite></p>
</blockquote>
<p>シンプルにコンテンツを管理できるようです。</p>
<h2 id="section-menu-for-lazy-bloggers">Section Menu for Lazy Bloggers</h2>
<blockquote>
<p>To enable this menu, configure sectionPagesMenu in your site config:</p>
<pre><code>sectionPagesMenu = &quot;main&quot;
</code></pre>
<p><cite><a href="https://gohugo.io/templates/menu-templates/#section-menu-for-lazy-bloggers">Menu Templates | Hugo</a></cite></p>
</blockquote>
<p>Section Menu は、 Section (content/ ディレクトリー直下のディレクトリー) に合わせてメニューに関する情報を作ってくれるもののようです。</p>
<h3 id="configtoml">config.toml</h3>
<p>設定ファイル (config.(toml|yaml|json)) に次の内容を追加しました。
TOML の例です。</p>
<pre><code>sectionPagesMenu = &quot;main&quot;
</code></pre><p>これで Hugo が自動的に Section に合わせてメニューに関する情報を作ってくれるようです。</p>
<h3 id="sidebarhtml">sidebar.html</h3>
<p>メニューを表示するレイアウトのファイル (theme/&lt;THEME&gt;/layouts/partial/sidebar.html) を次の通り作成しました。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">nav</span>&gt;
  &lt;<span style="color:#f92672">ul</span>&gt;
    {{ $currentPage := . }}
    {{ range .Site.Menus.main }}
      &lt;<span style="color:#f92672">li</span>&gt;
        &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ .URL }}&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ if $currentPage.IsMenuCurrent &#34;</span><span style="color:#a6e22e">main</span><span style="color:#960050;background-color:#1e0010">&#34;</span> <span style="color:#960050;background-color:#1e0010">.</span> <span style="color:#960050;background-color:#1e0010">}</span><span style="color:#960050;background-color:#1e0010">}</span><span style="color:#a6e22e">active</span><span style="color:#960050;background-color:#1e0010">{</span><span style="color:#960050;background-color:#1e0010">{</span> <span style="color:#a6e22e">else</span> <span style="color:#a6e22e">if</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">currentPage</span><span style="color:#960050;background-color:#1e0010">.</span><span style="color:#a6e22e">HasMenuCurrent</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#a6e22e">main</span><span style="color:#960050;background-color:#1e0010">&#34;</span> <span style="color:#960050;background-color:#1e0010">.</span> <span style="color:#960050;background-color:#1e0010">}</span><span style="color:#960050;background-color:#1e0010">}</span><span style="color:#a6e22e">has-menu</span><span style="color:#960050;background-color:#1e0010">{</span><span style="color:#960050;background-color:#1e0010">{</span> <span style="color:#a6e22e">end</span> <span style="color:#960050;background-color:#1e0010">}</span><span style="color:#960050;background-color:#1e0010">}</span><span style="color:#960050;background-color:#1e0010">&#34;</span>&gt;
          {{ .Name }}
          ({
            IsMenuCurrent: {{ $currentPage.IsMenuCurrent &#34;main&#34; . }},
            HasMenuCurrent: {{ $currentPage.HasMenuCurrent &#34;main&#34; . }}
          })
        &lt;/<span style="color:#f92672">a</span>&gt;
      &lt;/<span style="color:#f92672">li</span>&gt;
    {{ end }}
  &lt;/<span style="color:#f92672">ul</span>&gt;
&lt;/<span style="color:#f92672">nav</span>&gt;
</code></pre></div><p>Hugo が自動的に作ってくれたメニューに関する情報は、 <code>.Site.Menus.main</code> の変数で参照できるようです。
この <code>main</code> と、設定ファイルに記述した <code>sectionPagesMenu = &quot;main&quot;</code> の <code>main</code> が対応するようです。</p>
<p><code>$currentPage.IsMenuCurrent &quot;main&quot; .</code> は、表示しているページが、 <code>{{ range }}</code> で処理しているメニュー (Section) と <strong>一致する</strong> 場合に true を返すようです。</p>
<p><code>$currentPage.HasMenuCurrent &quot;main&quot; .</code> は、表示しているページが、 <code>{{ range }}</code> で処理しているメニュー (Section) に <strong>含まれる</strong> 場合に true を返すようです。</p>
<blockquote>
<p>Partial Templates</p>
<p>Partials are smaller, context-aware components in your list and page templates that can be used economically to keep your templating DRY.</p>
<p><cite><a href="https://gohugo.io/templates/partials/">Partial Templates | Hugo</a></cite></p>
</blockquote>
<p>ファイルを partials ディレクトリーに作成しましたが、これは Partial Templates というもののようです。
themes/&lt;THEME&gt;/layouts/partials/*&lt;PARTIALNAME&gt;.html のようなファイルを作成しておくと、共通的なレイアウトを二度記述する手間を省くことができるようです。</p>
<blockquote>
<p>All partials are called within your templates using the following pattern:</p>
<pre><code>{{ partial &quot;&lt;PATH&gt;/&lt;PARTIAL&gt;.html&quot; . }}
</code></pre>
<p><cite><a href="https://gohugo.io/templates/partials/#use-partials-in-your-templates">Use Partials in your Templates</a></cite></p>
</blockquote>
<p>Partial Templates を使うには、 <code>{{ partial &quot;sidebar.html&quot; . }}</code> のように記述すればよいみたいです。</p>
<h3 id="baseofhtml">baseof.html</h3>
<p><a href="/post/116/">以前の記事</a>を参考に、 baseof.html ファイル (theme/&lt;THEME&gt;/layout/_default/baseof.html) を次のように作成しました。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span>&gt;
  &lt;<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span>&gt;
    &lt;<span style="color:#f92672">title</span>&gt;
      {{ block &#34;title&#34; . }}
        {{ .Site.Title }}
      {{ end }}
    &lt;/<span style="color:#f92672">title</span>&gt;
    &lt;<span style="color:#f92672">style</span>&gt;
      .<span style="color:#a6e22e">active</span> {
        <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">darkorange</span>;
      }
      .<span style="color:#a6e22e">has-menu</span> {
        <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">darkgreen</span>;
      }
    &lt;/<span style="color:#f92672">style</span>&gt;
  &lt;/<span style="color:#f92672">head</span>&gt;
  &lt;<span style="color:#f92672">body</span>&gt;
    {{ block &#34;header&#34; . }}
    {{ end }}
    {{ block &#34;main&#34; . }}
    {{ end }}
    {{ block &#34;footer&#34; . }}
    {{ end }}
  &lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><p><code>.active</code> と <code>.has-menu</code> の文字の色を変えるようにしてみました。
一致する場合はオレンジで、 含まれる場合は緑にしました。</p>
<h3 id="listhtml">list.html</h3>
<p><a href="/post/116/">以前の記事</a>を参考に、 list.html ファイル (theme/&lt;THEME&gt;/layout/_default/list.html) を次のように作成しました。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">{{ define &#34;main&#34; }}
  &lt;<span style="color:#f92672">main</span>&gt;
    {{ partial &#34;sidebar.html&#34; . }}
    &lt;<span style="color:#f92672">h1</span>&gt;{{ .Title | humanize }}&lt;/<span style="color:#f92672">h1</span>&gt;
    {{ range .Data.Pages }}
      &lt;<span style="color:#f92672">article</span>&gt;
        &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ .RelPermalink }}&#34;</span>&gt;&lt;<span style="color:#f92672">h2</span>&gt;{{ .Title }}&lt;/<span style="color:#f92672">h2</span>&gt;&lt;/<span style="color:#f92672">a</span>&gt;
        &lt;<span style="color:#f92672">div</span>&gt;{{ .Date.Format &#34;2006/01/02&#34; }}&lt;/<span style="color:#f92672">div</span>&gt;
      &lt;/<span style="color:#f92672">article</span>&gt;
    {{ end }}
  &lt;/<span style="color:#f92672">main</span>&gt;
{{ end }}
</code></pre></div><p><code>{{ partial &quot;sidebar.html&quot; . }}</code> の箇所でメニューを表示してみました。
Partial Templates を使っています。</p>
<h3 id="singlehtml">single.html</h3>
<p><a href="/post/116/">以前の記事</a>を参考に、 single.html ファイル (theme/&lt;THEME&gt;/layout/_default/single.html) を次のように作成しました。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">{{ define &#34;title&#34; }}
  {{ .Title }} &amp;ndash; {{ .Site.Title }}
{{ end }}
{{ define &#34;main&#34; }}
  &lt;<span style="color:#f92672">main</span>&gt;
    {{ partial &#34;sidebar.html&#34; . }}
    &lt;<span style="color:#f92672">h1</span>&gt;{{ .Title }}&lt;/<span style="color:#f92672">h1</span>&gt;
    &lt;<span style="color:#f92672">article</span>&gt;
      &lt;<span style="color:#f92672">div</span>&gt;{{ .Date.Format &#34;2006/01/02&#34; }}&lt;/<span style="color:#f92672">div</span>&gt;
      {{ .Content }}
    &lt;/<span style="color:#f92672">article</span>&gt;
  &lt;/<span style="color:#f92672">main</span>&gt;
{{ end }}
</code></pre></div><p>list.html と同様に、 <code>{{ partial &quot;sidebar.html&quot; . }}</code> の箇所でメニューを表示してみました。</p>
<h3 id="content">content</h3>
<p>content/post ディレクトリーに、次の 2 つの examples の記事を作成しました。</p>
<ul>
<li>hello-hugo.md</li>
<li>another-post.md</li>
</ul>
<p>次のコマンドでダウンロードしました。</p>
<pre><code>$ install -d content/post
$ curl -L -o content/post/hello-hugo.md 'https://raw.githubusercontent.com/gohugoio/hugo/master/examples/blog/content/post/hello-hugo.md'
$ curl -L -o content/post/another-post.md 'https://raw.githubusercontent.com/gohugoio/hugo/master/examples/blog/content/post/another-post.md'
</code></pre><p>それから、 content/blog ディレクトリーに記事を 3 つ作成しました。
次のコマンドで作成しました。</p>
<pre><code>$ install -d content/blog
$ for i in {1..3}
do
cat &lt;&lt;word &gt; content/blog/blog-${i}.md
---
title: blog-${i}
date: 2018-01-0${i}
---
This is blog-${i}.
word
done
</code></pre><h3 id="hugo-のサーバーで確認">Hugo のサーバーで確認</h3>
<p>Hugo のサーバーで確認するために次のコマンドを入力します。</p>
<pre><code>$ hugo -t &lt;THEMENAME&gt; server
</code></pre><p>http://localhost:1313/ にアクセスします。
すると、メニューが表示されました。</p>
<p><img src="/img/132-01.png" alt=""></p>
<p>Blogs の方だけ確認します。
<code>IsMenuCurrent</code> は <code>false</code> で、 <code>HasMenuCurrent</code> も <code>false</code> のようです。
このページはどこの Section にも一致しない・含まれないようです。</p>
<p>次に、 http://localhost:1313/blog/ (メニューの Blogs リンク)にアクセスします。
すると、 Blogs Section の記事の一覧が表示されました。</p>
<p><img src="/img/132-02.png" alt=""></p>
<p>メニューの Blogs の <code>IsMenuCurrent</code> は <code>true</code> で、 <code>HasMenuCurrent</code> も <code>true</code> のようです。
Blogs のリンクの文字の色がオレンジになっていました。
このページは Blogs Section に <strong>一致する</strong> ようです。</p>
<p>次に、 http://localhost:1313/blog/blog-3/ (一覧の blog-3 リンク)にアクセスします。
すると、 blog-3 の記事の内容が表示されました。</p>
<p><img src="/img/132-03.png" alt=""></p>
<p>メニューの Blogs の <code>IsMenuCurrent</code> は <code>false</code> で、 <code>HasMenuCurrent</code> は <code>true</code> のようです。
Blogs のリンクの文字の色が緑になっていました。
このページは Blogs Section に <strong>含まれる</strong> ようです。</p>
<h3 id="section-menu-のまとめ">Section Menu のまとめ</h3>
<p>Section をネストしない、シンプルな階層であれば、 Section Menu で十分そうに感じました。</p>
<h2 id="site-config-menus">Site Config menus</h2>
<blockquote>
<p>The above is all that’s needed. But if you want custom menu items, e.g. changing weight, name, or link title attribute, you can define them manually in the site config file:</p>
<p>config.toml</p>
<pre><code>[menu]

  [[menu.main]]
    identifier = &quot;blog&quot;
    name = &quot;This is the blog section&quot;
    title = &quot;blog section&quot;
    url = &quot;/blog/&quot;
    weight = -110
</code></pre>
<blockquote>
<p>The identifier must match the section name.</p>
</blockquote>
<p><cite><a href="https://gohugo.io/templates/menu-templates/#site-config-menus">Menu Templates | Hugo</a></cite></p>
</blockquote>
<p>Section から自動的にメニューに関する情報を作るのではなく、設定ファイルにメニューに関する情報を記述することもできるようです。</p>
<h3 id="configtoml-1">config.toml</h3>
<p>最初に、 <a href="#config-toml">Section Menu for Lazy Bloggers</a> で設定した <code>sectionPagesMenu = &quot;main&quot;</code> を削除しました。</p>
<p>それから、次の内容を追加しました。
TOML の例です。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">menu</span>]

  [[<span style="color:#a6e22e">menu</span>.<span style="color:#a6e22e">main</span>]]
    <span style="color:#a6e22e">identifier</span> = <span style="color:#e6db74">&#34;blog&#34;</span>
    <span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;This is the blog section&#34;</span>
    <span style="color:#a6e22e">title</span> = <span style="color:#e6db74">&#34;blog section&#34;</span>
    <span style="color:#a6e22e">url</span> = <span style="color:#e6db74">&#34;/blog/&#34;</span>
    <span style="color:#a6e22e">weight</span> = <span style="color:#ae81ff">-110</span>

  [[<span style="color:#a6e22e">menu</span>.<span style="color:#a6e22e">main</span>]]
    <span style="color:#a6e22e">identifier</span> = <span style="color:#e6db74">&#34;child1&#34;</span>
    <span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;This is the child1 section&#34;</span>
    <span style="color:#a6e22e">title</span> = <span style="color:#e6db74">&#34;child1 section&#34;</span>
    <span style="color:#a6e22e">url</span> = <span style="color:#e6db74">&#34;/blog/child1/&#34;</span>
    <span style="color:#a6e22e">weight</span> = <span style="color:#ae81ff">-130</span>
    <span style="color:#a6e22e">parent</span> = <span style="color:#e6db74">&#34;blog&#34;</span>

  [[<span style="color:#a6e22e">menu</span>.<span style="color:#a6e22e">main</span>]]
    <span style="color:#a6e22e">identifier</span> = <span style="color:#e6db74">&#34;child2&#34;</span>
    <span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;This is the child2 section&#34;</span>
    <span style="color:#a6e22e">title</span> = <span style="color:#e6db74">&#34;child2 section&#34;</span>
    <span style="color:#a6e22e">url</span> = <span style="color:#e6db74">&#34;/blog/child2/&#34;</span>
    <span style="color:#a6e22e">weight</span> = <span style="color:#ae81ff">-120</span>
    <span style="color:#a6e22e">parent</span> = <span style="color:#e6db74">&#34;blog&#34;</span>

  [[<span style="color:#a6e22e">menu</span>.<span style="color:#a6e22e">main</span>]]
    <span style="color:#a6e22e">identifier</span> = <span style="color:#e6db74">&#34;post&#34;</span>
    <span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;This is the post section&#34;</span>
    <span style="color:#a6e22e">title</span> = <span style="color:#e6db74">&#34;post section&#34;</span>
    <span style="color:#a6e22e">url</span> = <span style="color:#e6db74">&#34;/post/&#34;</span>
    <span style="color:#a6e22e">weight</span> = <span style="color:#ae81ff">-100</span>
</code></pre></div><p>TOML の記述にあまり慣れていないのですが、 <code>menu.main</code> の配列に key, value を持ったオブジェクトを設定しているようです。
<code>identifier</code> は content/xxx ディレクトリー (Section) と一致させるようです。</p>
<p>ネストした Section は、 <code>parent</code> に親の identifier(Section) を指定するようです。</p>
<h3 id="sidebarhtml-1">sidebar.html</h3>
<p>メニューのファイル (theme/&lt;THEME&gt;/layouts/partial/sidebar.html) を次の通り修正しました。</p>
<pre><code>&lt;!-- sidebar start --&gt;
&lt;aside&gt;
  &lt;ul&gt;
    {{ $currentPage := . }}
    {{ range .Site.Menus.main }}
      &lt;li&gt;
        &lt;a href=&quot;{{ .URL }}&quot; class=&quot;{{ if $currentPage.IsMenuCurrent &quot;main&quot; . }}active{{ else if $currentPage.HasMenuCurrent &quot;main&quot; . }}has-menu{{ end }}&quot;&gt;
          {{ .Name }}
          ({
            IsMenuCurrent: {{ $currentPage.IsMenuCurrent &quot;main&quot; . }},
            HasMenuCurrent: {{ $currentPage.HasMenuCurrent &quot;main&quot; . }}
          })
        &lt;/a&gt;
        {{ if .HasChildren }}
          &lt;ul&gt;
            {{ range .Children }}
              &lt;li&gt;
                &lt;a href=&quot;{{ .URL }}&quot; class=&quot;{{ if $currentPage.IsMenuCurrent &quot;main&quot; . }}active{{ else if $currentPage.HasMenuCurrent &quot;main&quot; . }}has-menu{{ end }}&quot;&gt;
                  {{ .Name }}
                  ({
                    IsMenuCurrent: {{ $currentPage.IsMenuCurrent &quot;main&quot; . }},
                    HasMenuCurrent: {{ $currentPage.HasMenuCurrent &quot;main&quot; . }}
                  })
                &lt;/a&gt;
              &lt;/li&gt;
            {{ end }}
          &lt;/ul&gt;
        {{end}}
      &lt;/li&gt;
    {{end}}
  &lt;/ul&gt;
&lt;/aside&gt;
</code></pre><p><code>{{ if .HasChildren }}</code> でネストしたメニューの存在を判断できるようです。
<code>{{ range .Children }}</code> でネストしたメニューを繰り返し処理できるようです。
1 階層ネストしただけで記述が面倒な感じになってしまいました。</p>
<h3 id="layouts">layouts</h3>
<p><a href="#baseof-html">baseof.html</a>, <a href="#list-html">list.html</a>, <a href="#single-html">single.html</a> は Section Menu for Lazy Bloggers で作成したものをそのまま使います。</p>
<h3 id="content-1">content</h3>
<p>Site Config menus では、メニューをネストすることができるようですので、 content を入れ替えます。
最初に Section Menu for Lazy Bloggers で作成した <a href="#content">content</a> を削除しておきました。</p>
<pre><code>$ rm -r ./content/*
</code></pre><p>blog Section の記事を作成します。</p>
<pre><code>$ install -d content/blog
$ for i in $(seq -f %02g 1 3)
do
cat &lt;&lt;word &gt; content/blog/blog-${i}.md
---
title: blog-${i}
date: 2018-01-${i}
---
This is blog-${i}.
word
done
$ cat &lt;&lt;word &gt; content/blog/_index.md
---
title: blog section index
---
This is blog section.
word
</code></pre><p>child1 Section の記事を作成します。</p>
<pre><code>$ install -d content/blog/child1
$ for i in $(seq -f %02g 4 6)
do
cat &lt;&lt;word &gt; content/blog/child1/child1-${i}.md
---
title: child1-${i}
date: 2018-01-${i}
---
This is child1-${i}.
word
done
$ cat &lt;&lt;word &gt; content/blog/child1/_index.md
---
title: child1 section
---
This is child1 section.
word
</code></pre><p>child2 Section の記事を作成します。</p>
<pre><code>$ install -d content/blog/child2
$ for i in $(seq -f %02g 7 9)
do
cat &lt;&lt;word &gt; content/blog/child2/child2-${i}.md
---
title: child2-${i}
date: 2018-01-${i}
---
This is child2-${i}.
word
done
$ cat &lt;&lt;word &gt; content/blog/child2/_index.md
---
title: child2 section
---
This is child2 section.
word
</code></pre><p>post Section の記事を作成します。</p>
<pre><code>$ install -d content/post
$ for i in $(seq -f %02g 10 12)
do
cat &lt;&lt;word &gt; content/post/post-${i}.md
---
title: post-${i}
date: 2018-01-${i}
---
This is post-${i}.
word
done
$ cat &lt;&lt;word &gt; content/post/_index.md
---
title: post section
---
This is post section.
word
</code></pre><h3 id="hugo-のサーバーで確認-1">Hugo のサーバーで確認</h3>
<p>Hugo のサーバーで確認するために次のコマンドを入力します。</p>
<pre><code>$ hugo -t &lt;THEMENAME&gt; server
</code></pre><p>http://localhost:1313/ にアクセスします。
すると、メニューが表示されました。</p>
<p><img src="/img/132-04.png" alt=""></p>
<p>Blogs の方だけ確認しようと思います。
<code>IsMenuCurrent</code> は <code>false</code> で、 <code>HasMenuCurrent</code> も <code>false</code> のようです。
このページはどこの Section にも一致しない・含まれないようです。</p>
<p>次に、 http://localhost:1313/blog/ (メニューの This is the blog section リンク)にアクセスします。
すると、 Blog section の記事の一覧が表示されました。</p>
<p><img src="/img/132-05.png" alt=""></p>
<p>メニューの This is the blog section の <code>IsMenuCurrent</code> は <code>true</code> で、 <code>HasMenuCurrent</code> は <code>false</code> のようです。
Section Menu の場合と違って、 <code>HasMenuCurrent</code> は <code>false</code> になるようでした。</p>
<p>次に、 http://localhost:1313/blog/child1/ (メニューの This is the child1 section リンク)にアクセスします。
すると、 Child1 section の記事の一覧が表示されました。</p>
<p><img src="/img/132-06.png" alt=""></p>
<p>メニューの This is the blog section の <code>IsMenuCurrent</code> は <code>false</code> で、 <code>HasMenuCurrent</code> は <code>true</code> のようです。
メニューの This is the child1 section の <code>IsMenuCurrent</code> は <code>true</code> で、 <code>HasMenuCurrent</code> は <code>false</code> のようです。
こちらも Section Menu の場合と違っていました。</p>
<p>次に、 http://localhost:1313/blog/child1/child1-06/ (一覧の child1-06 リンク)にアクセスします。
すると、 child1-06 の記事の内容が表示されました。</p>
<p><img src="/img/132-07.png" alt=""></p>
<p>メニューの This is the blog section の <code>IsMenuCurrent</code> は <code>false</code> で、 <code>HasMenuCurrent</code> も <code>false</code> のようです。
メニューの This is the child1 section の <code>IsMenuCurrent</code> は <code>false</code> で、 <code>HasMenuCurrent</code> も <code>false</code> のようです。
こちらも Section Menu の場合と違っていました。</p>
<h3 id="site-config-menus-のまとめ">Site Config menus のまとめ</h3>
<p><code>IsMenuCurrent</code> と <code>HasMenuCurrent</code> がうまく使えませんでした。
設定ファイルが悪いのかな。</p>
<p>今回は、 Section をネストするために、 content/blog/child1/_index.md のようなファイルを作成しました。
<a href="https://gohugo.io/content-management/page-bundles/#branch-bundles">Branch Bundles</a> と言うそうですが、これを作成しておくと、ネストしたディレクトリーも Section として扱ってくれるようです。
Hugo は標準では content/ の直下のディレクトリーしか Section として扱ってくれません。
でも、 _index.md (拡張子は .html でも .json でも、妥当な MIME タイプのものならいいみたい)のようなファイルを作成しておくと、ネストしたディレクトリーも Section として扱ってくれるようです。</p>
<p>でも、ネストしたディレクトリーを Section とすると、複雑になるので、あまりしない方が良さそうに感じました。</p>
<h2 id="終わり">終わり</h2>
<p>この記事を書いている途中で、 <a href="https://gohugo.io/content-management/page-bundles/#branch-bundles">Nested Section</a> が思った通りに表示できなくて、 Hugo のバージョンをアップしました。
v0.31.1 から v0.38.2 になっていました。
前回 Hugo をインストールしてから、まだ、半年も経過していないと思うのですが、頻繁にメンテナンスされているようでした。</p>
<p>今回は扱わなかったのですが、 <a href="https://gohugo.io/templates/menu-templates/#menu-entries-from-the-page-s-front-matter">Menu Entries from the Page’s front matter</a> でも、各記事の front matter にメニューに関する記述をすることもできるようです。</p>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://gohugo.io/content-management/menus/">Menus | Hugo</a></li>
<li><a href="https://gohugo.io/templates/menu-templates/">Menu Templates | Hugo</a></li>
<li><a href="https://gohugo.io/variables/menus/">Menu Variables | Hugo</a></li>
<li><a href="https://gohugo.io/templates/partials/">Partial Templates | Hugo</a></li>
<li><a href="https://gohugo.io/content-management/page-bundles/#branch-bundles">Page Bundles | Hugo</a></li>
</ul>
<h2 id="15-april-2018-追記">15 April 2018 追記</h2>
<p>次の記事を書きました。</p>
<ul>
<li><a href="/post/135/">Hugo のテーマを作ってみます 7(Pagination)</a></li>
</ul>
      
        <aside class="ads">
  <div>広告</div>
  <div>
    <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9305907051774965" data-ad-slot="2028899530" data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</aside>
<style>
  aside.ads {
    margin-bottom: 2.5rem;
    margin-top: 2.5rem;
  }
</style>

      
    </article>
  </main>

        </div><footer>
  <small>&copy; 2015 Espresso &amp; Onigiri</small>
  <a href="https://gohugo.io">
    <img alt="Hugo" src="/img/hugo-logo-wide.svg">
  </a>
</footer>
<style>
  footer {
    align-items: center;
    border-top: #e2e8f0 solid 1px;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    height: 73px;
    justify-content: space-between;
    margin: 0px auto;
    width: 992px;
  }
  footer small {
    height: 40px;
    line-height: 40px;
  }
  footer img {
    height: 40px;
    vertical-align: middle;
    width: 160px;
  }
  @media screen and (max-width: 992px) {
    footer {
      margin-bottom: 64px;
      padding-left: 1%;
      padding-right: 1%;
      width: 98%;
    }
    footer img {
      width: 100px;
    }
  }
</style>
</body>
</html>
